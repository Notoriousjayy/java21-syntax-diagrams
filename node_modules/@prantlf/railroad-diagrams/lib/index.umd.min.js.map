{"version":3,"file":"index.umd.min.js","sources":["../railroad.js"],"sourcesContent":["\"use strict\";\n\n// Export function versions of all the constructors.\n// Each class will add itself to this object.\nconst funcs = {};\nexport default funcs;\n\nexport const Options = {\n\tDEBUG: false, // if true, writes some debug information into attributes\n\tVS: 8, // minimum vertical separation between things. For a 3px stroke, must be at least 4\n\tAR: 10, // radius of arcs\n\tDIAGRAM_CLASS: 'railroad-diagram', // class to put on the root <svg>\n\tSTROKE_ODD_PIXEL_LENGTH: true, // is the stroke width an odd (1px, 3px, etc) pixel length?\n\tINTERNAL_ALIGNMENT: 'center', // how to align items when they have extra space. left/right/center\n\tCHAR_WIDTH: 8.5, // width of each monospace character. play until you find the right value for your font\n\tCOMMENT_CHAR_WIDTH: 7, // comments are in smaller text by default\n};\n\nexport const defaultCSS = `\n\tsvg {\n\t\tbackground-color: hsl(30,20%,95%);\n\t}\n\tpath {\n\t\tstroke-width: 3;\n\t\tstroke: black;\n\t\tfill: rgba(0,0,0,0);\n\t}\n\ttext {\n\t\tfont: bold 14px monospace;\n\t\ttext-anchor: middle;\n\t\twhite-space: pre;\n\t}\n\ttext.diagram-text {\n\t\tfont-size: 12px;\n\t}\n\ttext.diagram-arrow {\n\t\tfont-size: 16px;\n\t}\n\ttext.label {\n\t\ttext-anchor: start;\n\t}\n\ttext.comment {\n\t\tfont: italic 12px monospace;\n\t}\n\tg.non-terminal text {\n\t\t/*font-style: italic;*/\n\t}\n\trect {\n\t\tstroke-width: 3;\n\t\tstroke: black;\n\t\tfill: hsl(120,100%,90%);\n\t}\n\trect.group-box {\n\t\tstroke: gray;\n\t\tstroke-dasharray: 10 5;\n\t\tfill: none;\n\t}\n\tpath.diagram-text {\n\t\tstroke-width: 3;\n\t\tstroke: black;\n\t\tfill: white;\n\t\tcursor: help;\n\t}\n\tg.diagram-text:hover path.diagram-text {\n\t\tfill: #eee;\n\t}`;\n\n\nexport class FakeSVG {\n\tconstructor(tagName, attrs, text) {\n\t\tif(text) this.children = text;\n\t\telse this.children = [];\n\t\tthis.tagName = tagName;\n\t\tthis.attrs = unnull(attrs, {});\n\t}\n\tformat(/*x, y, width*/) {\n\t\t// Virtual\n\t}\n\taddTo(parent) {\n\t\tif(parent instanceof FakeSVG) {\n\t\t\tparent.children.push(this);\n\t\t\treturn this;\n\t\t} else {\n\t\t\tvar svg = this.toSVG();\n\t\t\tparent.appendChild(svg);\n\t\t\treturn svg;\n\t\t}\n\t}\n\ttoSVG() {\n\t\tvar el = SVG(this.tagName, this.attrs);\n\t\tif(typeof this.children == 'string') {\n\t\t\tel.textContent = this.children;\n\t\t} else {\n\t\t\tthis.children.forEach(function(e) {\n\t\t\t\tel.appendChild(e.toSVG());\n\t\t\t});\n\t\t}\n\t\treturn el;\n\t}\n\ttoString() {\n\t\tvar str = '<' + this.tagName;\n\t\tvar group = this.tagName == \"g\" || this.tagName == \"svg\";\n\t\tfor(var attr in this.attrs) {\n\t\t\tstr += ' ' + attr + '=\"' + (this.attrs[attr]+'').replace(/&/g, '&amp;').replace(/\"/g, '&quot;') + '\"';\n\t\t}\n\t\tstr += '>';\n\t\tif(group) str += \"\\n\";\n\t\tif(typeof this.children == 'string') {\n\t\t\tstr += escapeString(this.children);\n\t\t} else {\n\t\t\tthis.children.forEach(function(e) {\n\t\t\t\tstr += e;\n\t\t\t});\n\t\t}\n\t\tstr += '</' + this.tagName + '>\\n';\n\t\treturn str;\n\t}\n\twalk(cb) {\n\t\tcb(this);\n\t}\n}\n\n\nexport class Path extends FakeSVG {\n\tconstructor(x,y) {\n\t\tsuper('path');\n\t\tthis.attrs.d = \"M\"+x+' '+y;\n\t}\n\tm(x,y) {\n\t\tthis.attrs.d += 'm'+x+' '+y;\n\t\treturn this;\n\t}\n\th(val) {\n\t\tthis.attrs.d += 'h'+val;\n\t\treturn this;\n\t}\n\tright(val) { return this.h(Math.max(0, val)); }\n\tleft(val) { return this.h(-Math.max(0, val)); }\n\tv(val) {\n\t\tthis.attrs.d += 'v'+val;\n\t\treturn this;\n\t}\n\tdown(val) { return this.v(Math.max(0, val)); }\n\tup(val) { return this.v(-Math.max(0, val)); }\n\tarc(sweep){\n\t\t// 1/4 of a circle\n\t\tvar x = Options.AR;\n\t\tvar y = Options.AR;\n\t\tif(sweep[0] == 'e' || sweep[1] == 'w') {\n\t\t\tx *= -1;\n\t\t}\n\t\tif(sweep[0] == 's' || sweep[1] == 'n') {\n\t\t\ty *= -1;\n\t\t}\n\t\tvar cw;\n\t\tif(sweep == 'ne' || sweep == 'es' || sweep == 'sw' || sweep == 'wn') {\n\t\t\tcw = 1;\n\t\t} else {\n\t\t\tcw = 0;\n\t\t}\n\t\tthis.attrs.d += \"a\"+Options.AR+\" \"+Options.AR+\" 0 0 \"+cw+' '+x+' '+y;\n\t\treturn this;\n\t}\n\tarc_8(start, dir) {\n\t\t// 1/8 of a circle\n\t\tconst arc = Options.AR;\n\t\tconst s2 = 1/Math.sqrt(2) * arc;\n\t\tconst s2inv = (arc - s2);\n\t\tlet path = \"a \" + arc + \" \" + arc + \" 0 0 \" + (dir=='cw' ? \"1\" : \"0\") + \" \";\n\t\tconst sd = start+dir;\n\t\tconst offset =\n\t\t\tsd == 'ncw'   ? [s2, s2inv] :\n\t\t\tsd == 'necw'  ? [s2inv, s2] :\n\t\t\tsd == 'ecw'   ? [-s2inv, s2] :\n\t\t\tsd == 'secw'  ? [-s2, s2inv] :\n\t\t\tsd == 'scw'   ? [-s2, -s2inv] :\n\t\t\tsd == 'swcw'  ? [-s2inv, -s2] :\n\t\t\tsd == 'wcw'   ? [s2inv, -s2] :\n\t\t\tsd == 'nwcw'  ? [s2, -s2inv] :\n\t\t\tsd == 'nccw'  ? [-s2, s2inv] :\n\t\t\tsd == 'nwccw' ? [-s2inv, s2] :\n\t\t\tsd == 'wccw'  ? [s2inv, s2] :\n\t\t\tsd == 'swccw' ? [s2, s2inv] :\n\t\t\tsd == 'sccw'  ? [s2, -s2inv] :\n\t\t\tsd == 'seccw' ? [s2inv, -s2] :\n\t\t\tsd == 'eccw'  ? [-s2inv, -s2] :\n\t\t\tsd == 'neccw' ? [-s2, -s2inv] : null\n\t\t;\n\t\tpath += offset.join(\" \");\n\t\tthis.attrs.d += path;\n\t\treturn this;\n\t}\n\tl(x, y) {\n\t\tthis.attrs.d += 'l'+x+' '+y;\n\t\treturn this;\n\t}\n\tformat() {\n\t\t// All paths in this library start/end horizontally.\n\t\t// The extra .5 ensures a minor overlap, so there's no seams in bad rasterizers.\n\t\tthis.attrs.d += 'h.5';\n\t\treturn this;\n\t}\n}\n\n\nexport class DiagramMultiContainer extends FakeSVG {\n\tconstructor(tagName, items, attrs, text) {\n\t\tsuper(tagName, attrs, text);\n\t\tthis.items = items.map(wrapString);\n\t}\n\twalk(cb) {\n\t\tcb(this);\n\t\tthis.items.forEach(x=>x.walk(cb));\n\t}\n}\n\n\nexport class Diagram extends DiagramMultiContainer {\n\tconstructor(...items) {\n\t\tsuper('svg', items, {class: Options.DIAGRAM_CLASS});\n\t\tif(!(this.items[0] instanceof Start)) {\n\t\t\tthis.items.unshift(new Start());\n\t\t}\n\t\tif(!(this.items[this.items.length-1] instanceof End)) {\n\t\t\tthis.items.push(new End());\n\t\t}\n\t\tthis.up = this.down = this.height = this.width = 0;\n\t\tfor(const item of this.items) {\n\t\t\tthis.width += item.width + (item.needsSpace?20:0);\n\t\t\tthis.up = Math.max(this.up, item.up - this.height);\n\t\t\tthis.height += item.height;\n\t\t\tthis.down = Math.max(this.down - item.height, item.down);\n\t\t}\n\t\tthis.formatted = false;\n\t}\n\tformat(paddingt, paddingr, paddingb, paddingl) {\n\t\tpaddingt = unnull(paddingt, 20);\n\t\tpaddingr = unnull(paddingr, paddingt, 20);\n\t\tpaddingb = unnull(paddingb, paddingt, 20);\n\t\tpaddingl = unnull(paddingl, paddingr, 20);\n\t\tvar x = paddingl;\n\t\tvar y = paddingt;\n\t\ty += this.up;\n\t\tvar g = new FakeSVG('g', Options.STROKE_ODD_PIXEL_LENGTH ? {transform:'translate(.5 .5)'} : {});\n\t\tfor(var i = 0; i < this.items.length; i++) {\n\t\t\tvar item = this.items[i];\n\t\t\tif(item.needsSpace) {\n\t\t\t\tnew Path(x,y).h(10).addTo(g);\n\t\t\t\tx += 10;\n\t\t\t}\n\t\t\titem.format(x, y, item.width).addTo(g);\n\t\t\tx += item.width;\n\t\t\ty += item.height;\n\t\t\tif(item.needsSpace) {\n\t\t\t\tnew Path(x,y).h(10).addTo(g);\n\t\t\t\tx += 10;\n\t\t\t}\n\t\t}\n\t\tthis.attrs.width = this.width + paddingl + paddingr;\n\t\tthis.attrs.height = this.up + this.height + this.down + paddingt + paddingb;\n\t\tthis.attrs.viewBox = \"0 0 \" + this.attrs.width + \" \" + this.attrs.height;\n\t\tg.addTo(this);\n\t\tthis.formatted = true;\n\t\treturn this;\n\t}\n\taddTo(parent) {\n\t\tif(!parent) {\n\t\t\tvar scriptTag = document.getElementsByTagName('script');\n\t\t\tscriptTag = scriptTag[scriptTag.length - 1];\n\t\t\tparent = scriptTag.parentNode;\n\t\t}\n\t\treturn super.addTo.call(this, parent);\n\t}\n\ttoSVG() {\n\t\tif(!this.formatted) {\n\t\t\tthis.format();\n\t\t}\n\t\treturn super.toSVG.call(this);\n\t}\n\ttoString() {\n\t\tif(!this.formatted) {\n\t\t\tthis.format();\n\t\t}\n\t\treturn super.toString.call(this);\n\t}\n\ttoStandalone(style) {\n\t\tif(!this.formatted) {\n\t\t\tthis.format();\n\t\t}\n\t\tconst s = new FakeSVG('style', {}, style || defaultCSS);\n\t\tthis.children.push(s);\n\t\tthis.attrs.xmlns = \"http://www.w3.org/2000/svg\";\n\t\tthis.attrs['xmlns:xlink'] = \"http://www.w3.org/1999/xlink\";\n\t\tconst result = super.toString.call(this);\n\t\tthis.children.pop();\n\t\tdelete this.attrs.xmlns;\n\t\treturn result;\n\t}\n\tstatic fromJSON(input = []) {\n\t\treturn diagramFromJSON(Diagram, input);\n\t}\n}\nfuncs.Diagram = (...args)=>new Diagram(...args);\nfuncs.Diagram.fromJSON = Diagram.fromJSON;\n\n\nexport class ComplexDiagram extends FakeSVG {\n\tconstructor(...items) {\n\t\tvar diagram = new Diagram(...items);\n\t\tdiagram.items[0] = new Start({type:\"complex\"});\n\t\tdiagram.items[diagram.items.length-1] = new End({type:\"complex\"});\n\t\treturn diagram;\n\t}\n\tstatic fromJSON(input = []) {\n\t\treturn diagramFromJSON(ComplexDiagram, input);\n\t}\n}\nfuncs.ComplexDiagram = (...args)=>new ComplexDiagram(...args);\nfuncs.ComplexDiagram.fromJSON = ComplexDiagram.fromJSON;\n\n\nexport class Sequence extends DiagramMultiContainer {\n\tconstructor(...items) {\n\t\tsuper('g', items);\n\t\tvar numberOfItems = this.items.length;\n\t\tthis.needsSpace = true;\n\t\tthis.up = this.down = this.height = this.width = 0;\n\t\tfor(var i = 0; i < numberOfItems; i++) {\n\t\t\tvar item = this.items[i];\n\t\t\tthis.width += item.width + (item.needsSpace?20:0);\n\t\t\tthis.up = Math.max(this.up, item.up - this.height);\n\t\t\tthis.height += item.height;\n\t\t\tthis.down = Math.max(this.down - item.height, item.down);\n\t\t}\n\t\tif(this.items[0].needsSpace) this.width -= 10;\n\t\tif(this.items[numberOfItems-1].needsSpace) this.width -= 10;\n\t\tif(Options.DEBUG) {\n\t\t\tthis.attrs['data-updown'] = this.up + \" \" + this.height + \" \" + this.down;\n\t\t\tthis.attrs['data-type'] = \"sequence\";\n\t\t}\n\t}\n\tformat(x,y,width) {\n\t\t// Hook up the two sides if this is narrower than its stated width.\n\t\tvar gaps = determineGaps(width, this.width);\n\t\tnew Path(x,y).h(gaps[0]).addTo(this);\n\t\tnew Path(x+gaps[0]+this.width,y+this.height).h(gaps[1]).addTo(this);\n\t\tx += gaps[0];\n\n\t\tfor(var i = 0; i < this.items.length; i++) {\n\t\t\tvar item = this.items[i];\n\t\t\tif(item.needsSpace && i > 0) {\n\t\t\t\tnew Path(x,y).h(10).addTo(this);\n\t\t\t\tx += 10;\n\t\t\t}\n\t\t\titem.format(x, y, item.width).addTo(this);\n\t\t\tx += item.width;\n\t\t\ty += item.height;\n\t\t\tif(item.needsSpace && i < this.items.length-1) {\n\t\t\t\tnew Path(x,y).h(10).addTo(this);\n\t\t\t\tx += 10;\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n}\nfuncs.Sequence = (...args)=>new Sequence(...args);\n\n\nexport class Stack extends DiagramMultiContainer {\n\tconstructor(...items) {\n\t\tsuper('g', items);\n\t\tif( items.length === 0 ) {\n\t\t\tthrow new RangeError(\"Stack() must have at least one child.\");\n\t\t}\n\t\tthis.width = Math.max.apply(null, this.items.map(function(e) { return e.width + (e.needsSpace?20:0); }));\n\t\t//if(this.items[0].needsSpace) this.width -= 10;\n\t\t//if(this.items[this.items.length-1].needsSpace) this.width -= 10;\n\t\tif(this.items.length > 1){\n\t\t\tthis.width += Options.AR*2;\n\t\t}\n\t\tthis.needsSpace = true;\n\t\tthis.up = this.items[0].up;\n\t\tthis.down = this.items[this.items.length-1].down;\n\n\t\tthis.height = 0;\n\t\tvar last = this.items.length - 1;\n\t\tfor(var i = 0; i < this.items.length; i++) {\n\t\t\tvar item = this.items[i];\n\t\t\tthis.height += item.height;\n\t\t\tif(i > 0) {\n\t\t\t\tthis.height += Math.max(Options.AR*2, item.up + Options.VS);\n\t\t\t}\n\t\t\tif(i < last) {\n\t\t\t\tthis.height += Math.max(Options.AR*2, item.down + Options.VS);\n\t\t\t}\n\t\t}\n\t\tif(Options.DEBUG) {\n\t\t\tthis.attrs['data-updown'] = this.up + \" \" + this.height + \" \" + this.down;\n\t\t\tthis.attrs['data-type'] = \"stack\";\n\t\t}\n\t}\n\tformat(x,y,width) {\n\t\tvar gaps = determineGaps(width, this.width);\n\t\tnew Path(x,y).h(gaps[0]).addTo(this);\n\t\tx += gaps[0];\n\t\tvar xInitial = x;\n\t\tif(this.items.length > 1) {\n\t\t\tnew Path(x, y).h(Options.AR).addTo(this);\n\t\t\tx += Options.AR;\n\t\t}\n\n\t\tfor(var i = 0; i < this.items.length; i++) {\n\t\t\tvar item = this.items[i];\n\t\t\tvar innerWidth = this.width - (this.items.length>1 ? Options.AR*2 : 0);\n\t\t\titem.format(x, y, innerWidth).addTo(this);\n\t\t\tx += innerWidth;\n\t\t\ty += item.height;\n\n\t\t\tif(i !== this.items.length-1) {\n\t\t\t\tnew Path(x, y)\n\t\t\t\t\t.arc('ne').down(Math.max(0, item.down + Options.VS - Options.AR*2))\n\t\t\t\t\t.arc('es').left(innerWidth)\n\t\t\t\t\t.arc('nw').down(Math.max(0, this.items[i+1].up + Options.VS - Options.AR*2))\n\t\t\t\t\t.arc('ws').addTo(this);\n\t\t\t\ty += Math.max(item.down + Options.VS, Options.AR*2) + Math.max(this.items[i+1].up + Options.VS, Options.AR*2);\n\t\t\t\t//y += Math.max(Options.AR*4, item.down + Options.VS*2 + this.items[i+1].up)\n\t\t\t\tx = xInitial+Options.AR;\n\t\t\t}\n\n\t\t}\n\n\t\tif(this.items.length > 1) {\n\t\t\tnew Path(x,y).h(Options.AR).addTo(this);\n\t\t\tx += Options.AR;\n\t\t}\n\t\tnew Path(x,y).h(gaps[1]).addTo(this);\n\n\t\treturn this;\n\t}\n}\nfuncs.Stack = (...args)=>new Stack(...args);\n\n\nexport class VerticalSequence extends DiagramMultiContainer {\n\tconstructor(...items) {\n\t\tsuper('g', items);\n\t\tif( items.length === 0 ) {\n\t\t\tthrow new RangeError(\"VerticalSequence() must have at least one child.\");\n\t\t}\n\t\tthis.items = items.map(wrapString);\n\t\tthis.width = Math.max.apply(null, this.items.map(function(e) { return e.width + (e.needsSpace?20:0); }));\n\t\t//if(this.items[0].needsSpace) this.width -= 10;\n\t\t//if(this.items[this.items.length-1].needsSpace) this.width -= 10;\n\t\tif(this.items.length > 1){\n\t\t\tthis.width += Options.AR*2;\n\t\t}\n\t\tthis.needsSpace = true;\n\t\tthis.up = this.items[0].up;\n\t\tthis.down = this.items[this.items.length-1].down;\n\n\t\tthis.height = 0;\n\t\tvar last = this.items.length - 1;\n\t\tfor(var i = 0; i < this.items.length; i++) {\n\t\t\tif(i !== last) {\n\t\t\t\tthis.height += this.items[i].height + this.items[i].down + this.items[i+1].up + Options.VS*2;\n\t\t\t}\n\t\t}\n\t\tif(Options.DEBUG) {\n\t\t\tthis.attrs['data-updown'] = this.up + \" \" + this.height + \" \" + this.down\n\t\t\tthis.attrs['data-type'] = \"verticalsequence\"\n\t\t}\n\t}\n\tformat(x,y,width) {\n\t\tvar gaps = determineGaps(width, this.width);\n\t\tnew Path(x,y).h(gaps[0]).addTo(this);\n\t\tx += gaps[0];\n\t\tvar xInitial = x;\n\t\tvar minWidth = 1000;\n\t\tfor(let itemNum in this.items){\n\t\t\tlet item = this.items[itemNum];\n\t\t\tminWidth = item.width < minWidth ? item.width : minWidth;\n\t\t}\n\n\t\tfor(var i = 0; i < this.items.length; i++) {\n\t\t\tvar item = this.items[i];\n\t\t\titem.format(x, y, item.width).addTo(this);\n\t\t\ty += item.height;\n\n\t\t\tif(i !== this.items.length-1) {\n\t\t\t\tx += minWidth / 2;\n\t\t\t\ty += item.down\n\t\t\t\tnew Path(x, y)\n\t\t\t\t\t.v(Options.VS*2).addTo(this)\n\t\t\t\ty += this.items[i+1].up + Options.VS*2;\n\t\t\t\tx = xInitial;\n\t\t\t}\n\t\t\telse{\n\t\t\t\tx += item.width;\n\t\t\t\ty += item.height;\n\t\t\t}\n\n\t\t}\n\n\t\tif(this.items.length > 1) {\n\t\t\tnew Path(x,y).h(this.width - this.items[this.items.length - 1].width).addTo(this);\n\t\t\tx += Options.AR;\n\t\t}\n\t\tnew Path(x,y).h(gaps[1]).addTo(this);\n\n\t\treturn this;\n\t}\n}\nfuncs.VerticalSequence = (...args)=>new VerticalSequence(...args);\n\n\nexport class OptionalSequence extends DiagramMultiContainer {\n\tconstructor(...items) {\n\t\tsuper('g', items);\n\t\tif( items.length === 0 ) {\n\t\t\tthrow new RangeError(\"OptionalSequence() must have at least one child.\");\n\t\t}\n\t\tif( items.length === 1 ) {\n\t\t\treturn new Sequence(items);\n\t\t}\n\t\tvar arc = Options.AR;\n\t\tthis.needsSpace = false;\n\t\tthis.width = 0;\n\t\tthis.up = 0;\n\t\tthis.height = sum(this.items, function(x){return x.height});\n\t\tthis.down = this.items[0].down;\n\t\tvar heightSoFar = 0;\n\t\tfor(var i = 0; i < this.items.length; i++) {\n\t\t\tvar item = this.items[i];\n\t\t\tthis.up = Math.max(this.up, Math.max(arc*2, item.up + Options.VS) - heightSoFar);\n\t\t\theightSoFar += item.height;\n\t\t\tif(i > 0) {\n\t\t\t\tthis.down = Math.max(this.height + this.down, heightSoFar + Math.max(arc*2, item.down + Options.VS)) - this.height;\n\t\t\t}\n\t\t\tvar itemWidth = (item.needsSpace?10:0) + item.width;\n\t\t\tif(i === 0) {\n\t\t\t\tthis.width += arc + Math.max(itemWidth, arc);\n\t\t\t} else {\n\t\t\t\tthis.width += arc*2 + Math.max(itemWidth, arc) + arc;\n\t\t\t}\n\t\t}\n\t\tif(Options.DEBUG) {\n\t\t\tthis.attrs['data-updown'] = this.up + \" \" + this.height + \" \" + this.down;\n\t\t\tthis.attrs['data-type'] = \"optseq\";\n\t\t}\n\t}\n\tformat(x, y, width) {\n\t\tvar arc = Options.AR;\n\t\tvar gaps = determineGaps(width, this.width);\n\t\tnew Path(x, y).right(gaps[0]).addTo(this);\n\t\tnew Path(x + gaps[0] + this.width, y + this.height).right(gaps[1]).addTo(this);\n\t\tx += gaps[0];\n\t\tvar upperLineY = y - this.up;\n\t\tvar last = this.items.length - 1;\n\t\tfor(var i = 0; i < this.items.length; i++) {\n\t\t\tvar item = this.items[i];\n\t\t\tvar itemSpace = (item.needsSpace?10:0);\n\t\t\tvar itemWidth = item.width + itemSpace;\n\t\t\tif(i === 0) {\n\t\t\t\t// Upper skip\n\t\t\t\tnew Path(x,y)\n\t\t\t\t\t.arc('se')\n\t\t\t\t\t.up(y - upperLineY - arc*2)\n\t\t\t\t\t.arc('wn')\n\t\t\t\t\t.right(itemWidth - arc)\n\t\t\t\t\t.arc('ne')\n\t\t\t\t\t.down(y + item.height - upperLineY - arc*2)\n\t\t\t\t\t.arc('ws')\n\t\t\t\t\t.addTo(this);\n\t\t\t\t// Straight line\n\t\t\t\tnew Path(x, y)\n\t\t\t\t\t.right(itemSpace + arc)\n\t\t\t\t\t.addTo(this);\n\t\t\t\titem.format(x + itemSpace + arc, y, item.width).addTo(this);\n\t\t\t\tx += itemWidth + arc;\n\t\t\t\ty += item.height;\n\t\t\t\t// x ends on the far side of the first element,\n\t\t\t\t// where the next element's skip needs to begin\n\t\t\t} else if(i < last) {\n\t\t\t\t// Upper skip\n\t\t\t\tnew Path(x, upperLineY)\n\t\t\t\t\t.right(arc*2 + Math.max(itemWidth, arc) + arc)\n\t\t\t\t\t.arc('ne')\n\t\t\t\t\t.down(y - upperLineY + item.height - arc*2)\n\t\t\t\t\t.arc('ws')\n\t\t\t\t\t.addTo(this);\n\t\t\t\t// Straight line\n\t\t\t\tnew Path(x,y)\n\t\t\t\t\t.right(arc*2)\n\t\t\t\t\t.addTo(this);\n\t\t\t\titem.format(x + arc*2, y, item.width).addTo(this);\n\t\t\t\tnew Path(x + item.width + arc*2, y + item.height)\n\t\t\t\t\t.right(itemSpace + arc)\n\t\t\t\t\t.addTo(this);\n\t\t\t\t// Lower skip\n\t\t\t\tnew Path(x,y)\n\t\t\t\t\t.arc('ne')\n\t\t\t\t\t.down(item.height + Math.max(item.down + Options.VS, arc*2) - arc*2)\n\t\t\t\t\t.arc('ws')\n\t\t\t\t\t.right(itemWidth - arc)\n\t\t\t\t\t.arc('se')\n\t\t\t\t\t.up(item.down + Options.VS - arc*2)\n\t\t\t\t\t.arc('wn')\n\t\t\t\t\t.addTo(this);\n\t\t\t\tx += arc*2 + Math.max(itemWidth, arc) + arc;\n\t\t\t\ty += item.height;\n\t\t\t} else {\n\t\t\t\t// Straight line\n\t\t\t\tnew Path(x, y)\n\t\t\t\t\t.right(arc*2)\n\t\t\t\t\t.addTo(this);\n\t\t\t\titem.format(x + arc*2, y, item.width).addTo(this);\n\t\t\t\tnew Path(x + arc*2 + item.width, y + item.height)\n\t\t\t\t\t.right(itemSpace + arc)\n\t\t\t\t\t.addTo(this);\n\t\t\t\t// Lower skip\n\t\t\t\tnew Path(x,y)\n\t\t\t\t\t.arc('ne')\n\t\t\t\t\t.down(item.height + Math.max(item.down + Options.VS, arc*2) - arc*2)\n\t\t\t\t\t.arc('ws')\n\t\t\t\t\t.right(itemWidth - arc)\n\t\t\t\t\t.arc('se')\n\t\t\t\t\t.up(item.down + Options.VS - arc*2)\n\t\t\t\t\t.arc('wn')\n\t\t\t\t\t.addTo(this);\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n}\nfuncs.OptionalSequence = (...args)=>new OptionalSequence(...args);\n\n\nexport class AlternatingSequence extends DiagramMultiContainer {\n\tconstructor(...items) {\n\t\tsuper('g', items);\n\t\tif( items.length === 1 ) {\n\t\t\treturn new Sequence(items);\n\t\t}\n\t\tif( items.length !== 2 ) {\n\t\t\tthrow new RangeError(\"AlternatingSequence() must have one or two children.\");\n\t\t}\n\t\tthis.needsSpace = false;\n\n\t\tconst arc = Options.AR;\n\t\tconst vert = Options.VS;\n\t\tconst max = Math.max;\n\t\tconst first = this.items[0];\n\t\tconst second = this.items[1];\n\n\t\tconst arcX = 1 / Math.sqrt(2) * arc * 2;\n\t\tconst arcY = (1 - 1 / Math.sqrt(2)) * arc * 2;\n\t\tconst crossY = Math.max(arc, Options.VS);\n\t\tconst crossX = (crossY - arcY) + arcX;\n\n\t\tconst firstOut = max(arc + arc, crossY/2 + arc + arc, crossY/2 + vert + first.down);\n\t\tthis.up = firstOut + first.height + first.up;\n\n\t\tconst secondIn = max(arc + arc, crossY/2 + arc + arc, crossY/2 + vert + second.up);\n\t\tthis.down = secondIn + second.height + second.down;\n\n\t\tthis.height = 0;\n\n\t\tconst firstWidth = 2*(first.needsSpace?10:0) + first.width;\n\t\tconst secondWidth = 2*(second.needsSpace?10:0) + second.width;\n\t\tthis.width = 2*arc + max(firstWidth, crossX, secondWidth) + 2*arc;\n\n\t\tif(Options.DEBUG) {\n\t\t\tthis.attrs['data-updown'] = this.up + \" \" + this.height + \" \" + this.down;\n\t\t\tthis.attrs['data-type'] = \"altseq\";\n\t\t}\n\t}\n\tformat(x, y, width) {\n\t\tconst arc = Options.AR;\n\t\tconst gaps = determineGaps(width, this.width);\n\t\tnew Path(x,y).right(gaps[0]).addTo(this);\n\t\tx += gaps[0];\n\t\tnew Path(x+this.width, y).right(gaps[1]).addTo(this);\n\t\t// bounding box\n\t\t//new Path(x+gaps[0], y).up(this.up).right(this.width).down(this.up+this.down).left(this.width).up(this.down).addTo(this);\n\t\tconst first = this.items[0];\n\t\tconst second = this.items[1];\n\n\t\t// top\n\t\tconst firstIn = this.up - first.up;\n\t\tconst firstOut = this.up - first.up - first.height;\n\t\tnew Path(x,y).arc('se').up(firstIn-2*arc).arc('wn').addTo(this);\n\t\tfirst.format(x + 2*arc, y - firstIn, this.width - 4*arc).addTo(this);\n\t\tnew Path(x + this.width - 2*arc, y - firstOut).arc('ne').down(firstOut - 2*arc).arc('ws').addTo(this);\n\n\t\t// bottom\n\t\tconst secondIn = this.down - second.down - second.height;\n\t\tconst secondOut = this.down - second.down;\n\t\tnew Path(x,y).arc('ne').down(secondIn - 2*arc).arc('ws').addTo(this);\n\t\tsecond.format(x + 2*arc, y + secondIn, this.width - 4*arc).addTo(this);\n\t\tnew Path(x + this.width - 2*arc, y + secondOut).arc('se').up(secondOut - 2*arc).arc('wn').addTo(this);\n\n\t\t// crossover\n\t\tconst arcX = 1 / Math.sqrt(2) * arc * 2;\n\t\tconst arcY = (1 - 1 / Math.sqrt(2)) * arc * 2;\n\t\tconst crossY = Math.max(arc, Options.VS);\n\t\tconst crossX = (crossY - arcY) + arcX;\n\t\tconst crossBar = (this.width - 4*arc - crossX)/2;\n\t\tnew Path(x+arc, y - crossY/2 - arc).arc('ws').right(crossBar)\n\t\t\t.arc_8('n', 'cw').l(crossX - arcX, crossY - arcY).arc_8('sw', 'ccw')\n\t\t\t.right(crossBar).arc('ne').addTo(this);\n\t\tnew Path(x+arc, y + crossY/2 + arc).arc('wn').right(crossBar)\n\t\t\t.arc_8('s', 'ccw').l(crossX - arcX, -(crossY - arcY)).arc_8('nw', 'cw')\n\t\t\t.right(crossBar).arc('se').addTo(this);\n\n\t\treturn this;\n\t}\n}\nfuncs.AlternatingSequence = (...args)=>new AlternatingSequence(...args);\n\n\nexport class Choice extends DiagramMultiContainer {\n\tconstructor(normal, ...items) {\n\t\tsuper('g', items);\n\t\tif( typeof normal !== \"number\" || normal !== Math.floor(normal) ) {\n\t\t\tthrow new TypeError(\"The first argument of Choice() must be an integer.\");\n\t\t} else if(normal < 0 || normal >= items.length) {\n\t\t\tthrow new RangeError(\"The first argument of Choice() must be an index for one of the items.\");\n\t\t} else {\n\t\t\tthis.normal = normal;\n\t\t}\n\t\tvar first = 0;\n\t\tvar last = items.length - 1;\n\t\tthis.width = Math.max.apply(null, this.items.map(function(el){return el.width})) + Options.AR*4;\n\t\tthis.height = this.items[normal].height;\n\t\tthis.up = this.items[first].up;\n\t\tvar arcs;\n\t\tfor(var i = first; i < normal; i++) {\n\t\t\tif(i == normal-1) arcs = Options.AR*2;\n\t\t\telse arcs = Options.AR;\n\t\t\tthis.up += Math.max(arcs, this.items[i].height + this.items[i].down + Options.VS + this.items[i+1].up);\n\t\t}\n\t\tthis.down = this.items[last].down;\n\t\tfor(i = normal+1; i <= last; i++) {\n\t\t\tif(i == normal+1) arcs = Options.AR*2;\n\t\t\telse arcs = Options.AR;\n\t\t\tthis.down += Math.max(arcs, this.items[i-1].height + this.items[i-1].down + Options.VS + this.items[i].up);\n\t\t}\n\t\tthis.down -= this.items[normal].height; // already counted in Choice.height\n\t\tif(Options.DEBUG) {\n\t\t\tthis.attrs['data-updown'] = this.up + \" \" + this.height + \" \" + this.down;\n\t\t\tthis.attrs['data-type'] = \"choice\";\n\t\t}\n\t}\n\tformat(x,y,width) {\n\t\t// Hook up the two sides if this is narrower than its stated width.\n\t\tvar gaps = determineGaps(width, this.width);\n\t\tnew Path(x,y).h(gaps[0]).addTo(this);\n\t\tnew Path(x+gaps[0]+this.width,y+this.height).h(gaps[1]).addTo(this);\n\t\tx += gaps[0];\n\n\t\tvar last = this.items.length -1;\n\t\tvar innerWidth = this.width - Options.AR*4;\n\n\t\t// Do the elements that curve above\n\t\tvar distanceFromY;\n\t\tfor(var i = this.normal - 1; i >= 0; i--) {\n\t\t\tlet item = this.items[i];\n\t\t\tif( i == this.normal - 1 ) {\n\t\t\t\tdistanceFromY = Math.max(Options.AR*2, this.items[this.normal].up + Options.VS + item.down + item.height);\n\t\t\t}\n\t\t\tnew Path(x,y)\n\t\t\t\t.arc('se')\n\t\t\t\t.up(distanceFromY - Options.AR*2)\n\t\t\t\t.arc('wn').addTo(this);\n\t\t\titem.format(x+Options.AR*2,y - distanceFromY,innerWidth).addTo(this);\n\t\t\tnew Path(x+Options.AR*2+innerWidth, y-distanceFromY+item.height)\n\t\t\t\t.arc('ne')\n\t\t\t\t.down(distanceFromY - item.height + this.height - Options.AR*2)\n\t\t\t\t.arc('ws').addTo(this);\n\t\t\tdistanceFromY += Math.max(Options.AR, item.up + Options.VS + (i === 0 ? 0 : this.items[i-1].down+this.items[i-1].height));\n\t\t}\n\n\t\t// Do the straight-line path.\n\t\tnew Path(x,y).right(Options.AR*2).addTo(this);\n\t\tthis.items[this.normal].format(x+Options.AR*2, y, innerWidth).addTo(this);\n\t\tnew Path(x+Options.AR*2+innerWidth, y+this.height).right(Options.AR*2).addTo(this);\n\n\t\t// Do the elements that curve below\n\t\tfor(i = this.normal+1; i <= last; i++) {\n\t\t\tlet item = this.items[i];\n\t\t\tif( i == this.normal + 1 ) {\n\t\t\t\tdistanceFromY = Math.max(Options.AR*2, this.height + this.items[this.normal].down + Options.VS + item.up);\n\t\t\t}\n\t\t\tnew Path(x,y)\n\t\t\t\t.arc('ne')\n\t\t\t\t.down(distanceFromY - Options.AR*2)\n\t\t\t\t.arc('ws').addTo(this);\n\t\t\titem.format(x+Options.AR*2, y+distanceFromY, innerWidth).addTo(this);\n\t\t\tnew Path(x+Options.AR*2+innerWidth, y+distanceFromY+item.height)\n\t\t\t\t.arc('se')\n\t\t\t\t.up(distanceFromY - Options.AR*2 + item.height - this.height)\n\t\t\t\t.arc('wn').addTo(this);\n\t\t\tdistanceFromY += Math.max(Options.AR, item.height + item.down + Options.VS + (i == last ? 0 : this.items[i+1].up));\n\t\t}\n\n\t\treturn this;\n\t}\n}\nfuncs.Choice = (...args)=>new Choice(...args);\n\n\nexport class HorizontalChoice extends DiagramMultiContainer {\n\tconstructor(...items) {\n\t\tsuper('g', items);\n\t\tif( items.length === 0 ) {\n\t\t\tthrow new RangeError(\"HorizontalChoice() must have at least one child.\");\n\t\t}\n\t\tif( items.length === 1) {\n\t\t\treturn new Sequence(items);\n\t\t}\n\t\tconst allButLast = this.items.slice(0, -1);\n\t\tconst middles = this.items.slice(1, -1);\n\t\tconst first = this.items[0];\n\t\tconst last = this.items[this.items.length - 1];\n\t\tthis.needsSpace = false;\n\n\t\tthis.width = Options.AR; // starting track\n\t\tthis.width += Options.AR*2 * (this.items.length-1); // inbetween tracks\n\t\tthis.width += sum(this.items, x=>x.width + (x.needsSpace?20:0)); // items\n\t\tthis.width += (last.height > 0 ? Options.AR : 0); // needs space to curve up\n\t\tthis.width += Options.AR; //ending track\n\n\t\t// Always exits at entrance height\n\t\tthis.height = 0;\n\n\t\t// All but the last have a track running above them\n\t\tthis._upperTrack = Math.max(\n\t\t\tOptions.AR*2,\n\t\t\tOptions.VS,\n\t\t\tmax(allButLast, x=>x.up) + Options.VS\n\t\t);\n\t\tthis.up = Math.max(this._upperTrack, last.up);\n\n\t\t// All but the first have a track running below them\n\t\t// Last either straight-lines or curves up, so has different calculation\n\t\tthis._lowerTrack = Math.max(\n\t\t\tOptions.VS,\n\t\t\tmax(middles, x=>x.height+Math.max(x.down+Options.VS, Options.AR*2)),\n\t\t\tlast.height + last.down + Options.VS\n\t\t);\n\t\tif(first.height < this._lowerTrack) {\n\t\t\t// Make sure there's at least 2*AR room between first exit and lower track\n\t\t\tthis._lowerTrack = Math.max(this._lowerTrack, first.height + Options.AR*2);\n\t\t}\n\t\tthis.down = Math.max(this._lowerTrack, first.height + first.down);\n\n\n\t\tif(Options.DEBUG) {\n\t\t\tthis.attrs['data-updown'] = this.up + \" \" + this.height + \" \" + this.down;\n\t\t\tthis.attrs['data-type'] = \"horizontalchoice\";\n\t\t}\n\t}\n\tformat(x,y,width) {\n\t\t// Hook up the two sides if this is narrower than its stated width.\n\t\tvar gaps = determineGaps(width, this.width);\n\t\tnew Path(x,y).h(gaps[0]).addTo(this);\n\t\tnew Path(x+gaps[0]+this.width,y+this.height).h(gaps[1]).addTo(this);\n\t\tx += gaps[0];\n\n\t\tconst first = this.items[0];\n\t\tconst last = this.items[this.items.length-1];\n\t\tconst allButFirst = this.items.slice(1);\n\t\tconst allButLast = this.items.slice(0, -1);\n\n\t\t// upper track\n\t\tvar upperSpan = (sum(allButLast, x=>x.width+(x.needsSpace?20:0))\n\t\t\t+ (this.items.length - 2) * Options.AR*2\n\t\t\t- Options.AR\n\t\t);\n\t\tnew Path(x,y)\n\t\t\t.arc('se')\n\t\t\t.v(-(this._upperTrack - Options.AR*2))\n\t\t\t.arc('wn')\n\t\t\t.h(upperSpan)\n\t\t\t.addTo(this);\n\n\t\t// lower track\n\t\tvar lowerSpan = (sum(allButFirst, x=>x.width+(x.needsSpace?20:0))\n\t\t\t+ (this.items.length - 2) * Options.AR*2\n\t\t\t+ (last.height > 0 ? Options.AR : 0)\n\t\t\t- Options.AR\n\t\t);\n\t\tvar lowerStart = x + Options.AR + first.width+(first.needsSpace?20:0) + Options.AR*2;\n\t\tnew Path(lowerStart, y+this._lowerTrack)\n\t\t\t.h(lowerSpan)\n\t\t\t.arc('se')\n\t\t\t.v(-(this._lowerTrack - Options.AR*2))\n\t\t\t.arc('wn')\n\t\t\t.addTo(this);\n\n\t\t// Items\n\t\tfor(const [i, item] of enumerate(this.items)) {\n\t\t\t// input track\n\t\t\tif(i === 0) {\n\t\t\t\tnew Path(x,y)\n\t\t\t\t\t.h(Options.AR)\n\t\t\t\t\t.addTo(this);\n\t\t\t\tx += Options.AR;\n\t\t\t} else {\n\t\t\t\tnew Path(x, y - this._upperTrack)\n\t\t\t\t\t.arc('ne')\n\t\t\t\t\t.v(this._upperTrack - Options.AR*2)\n\t\t\t\t\t.arc('ws')\n\t\t\t\t\t.addTo(this);\n\t\t\t\tx += Options.AR*2;\n\t\t\t}\n\n\t\t\t// item\n\t\t\tvar itemWidth = item.width + (item.needsSpace?20:0);\n\t\t\titem.format(x, y, itemWidth).addTo(this);\n\t\t\tx += itemWidth;\n\n\t\t\t// output track\n\t\t\tif(i === this.items.length-1) {\n\t\t\t\tif(item.height === 0) {\n\t\t\t\t\tnew Path(x,y)\n\t\t\t\t\t\t.h(Options.AR)\n\t\t\t\t\t\t.addTo(this);\n\t\t\t\t} else {\n\t\t\t\t\tnew Path(x,y+item.height)\n\t\t\t\t\t.arc('se')\n\t\t\t\t\t.addTo(this);\n\t\t\t\t}\n\t\t\t} else if(i === 0 && item.height > this._lowerTrack) {\n\t\t\t\t// Needs to arc up to meet the lower track, not down.\n\t\t\t\tif(item.height - this._lowerTrack >= Options.AR*2) {\n\t\t\t\t\tnew Path(x, y+item.height)\n\t\t\t\t\t\t.arc('se')\n\t\t\t\t\t\t.v(this._lowerTrack - item.height + Options.AR*2)\n\t\t\t\t\t\t.arc('wn')\n\t\t\t\t\t\t.addTo(this);\n\t\t\t\t} else {\n\t\t\t\t\t// Not enough space to fit two arcs\n\t\t\t\t\t// so just bail and draw a straight line for now.\n\t\t\t\t\tnew Path(x, y+item.height)\n\t\t\t\t\t\t.l(Options.AR*2, this._lowerTrack - item.height)\n\t\t\t\t\t\t.addTo(this);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tnew Path(x, y+item.height)\n\t\t\t\t\t.arc('ne')\n\t\t\t\t\t.v(this._lowerTrack - item.height - Options.AR*2)\n\t\t\t\t\t.arc('ws')\n\t\t\t\t\t.addTo(this);\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n}\nfuncs.HorizontalChoice = (...args)=>new HorizontalChoice(...args);\n\n\nexport class MultipleChoice extends DiagramMultiContainer {\n\tconstructor(normal, type, ...items) {\n\t\tsuper('g', items);\n\t\tif( typeof normal !== \"number\" || normal !== Math.floor(normal) ) {\n\t\t\tthrow new TypeError(\"The first argument of MultipleChoice() must be an integer.\");\n\t\t} else if(normal < 0 || normal >= items.length) {\n\t\t\tthrow new RangeError(\"The first argument of MultipleChoice() must be an index for one of the items.\");\n\t\t} else {\n\t\t\tthis.normal = normal;\n\t\t}\n\t\tif( type != \"any\" && type != \"all\" ) {\n\t\t\tthrow new SyntaxError(\"The second argument of MultipleChoice must be 'any' or 'all'.\");\n\t\t} else {\n\t\t\tthis.type = type;\n\t\t}\n\t\tthis.needsSpace = true;\n\t\tthis.innerWidth = max(this.items, function(x){return x.width});\n\t\tthis.width = 30 + Options.AR + this.innerWidth + Options.AR + 20;\n\t\tthis.up = this.items[0].up;\n\t\tthis.down = this.items[this.items.length-1].down;\n\t\tthis.height = this.items[normal].height;\n\t\tfor(var i = 0; i < this.items.length; i++) {\n\t\t\tlet item = this.items[i];\n\t\t\tlet minimum;\n\t\t\tif(i == normal - 1 || i == normal + 1) minimum = 10 + Options.AR;\n\t\t\telse minimum = Options.AR;\n\t\t\tif(i < normal) {\n\t\t\t\tthis.up += Math.max(minimum, item.height + item.down + Options.VS + this.items[i+1].up);\n\t\t\t} else if(i > normal) {\n\t\t\t\tthis.down += Math.max(minimum, item.up + Options.VS + this.items[i-1].down + this.items[i-1].height);\n\t\t\t}\n\t\t}\n\t\tthis.down -= this.items[normal].height; // already counted in this.height\n\t\tif(Options.DEBUG) {\n\t\t\tthis.attrs['data-updown'] = this.up + \" \" + this.height + \" \" + this.down;\n\t\t\tthis.attrs['data-type'] = \"multiplechoice\";\n\t\t}\n\t}\n\tformat(x, y, width) {\n\t\tvar gaps = determineGaps(width, this.width);\n\t\tnew Path(x, y).right(gaps[0]).addTo(this);\n\t\tnew Path(x + gaps[0] + this.width, y + this.height).right(gaps[1]).addTo(this);\n\t\tx += gaps[0];\n\n\t\tvar normal = this.items[this.normal];\n\n\t\t// Do the elements that curve above\n\t\tvar distanceFromY;\n\t\tfor(var i = this.normal - 1; i >= 0; i--) {\n\t\t\tvar item = this.items[i];\n\t\t\tif( i == this.normal - 1 ) {\n\t\t\t\tdistanceFromY = Math.max(10 + Options.AR, normal.up + Options.VS + item.down + item.height);\n\t\t\t}\n\t\t\tnew Path(x + 30,y)\n\t\t\t\t.up(distanceFromY - Options.AR)\n\t\t\t\t.arc('wn').addTo(this);\n\t\t\titem.format(x + 30 + Options.AR, y - distanceFromY, this.innerWidth).addTo(this);\n\t\t\tnew Path(x + 30 + Options.AR + this.innerWidth, y - distanceFromY + item.height)\n\t\t\t\t.arc('ne')\n\t\t\t\t.down(distanceFromY - item.height + this.height - Options.AR - 10)\n\t\t\t\t.addTo(this);\n\t\t\tif(i !== 0) {\n\t\t\t\tdistanceFromY += Math.max(Options.AR, item.up + Options.VS + this.items[i-1].down + this.items[i-1].height);\n\t\t\t}\n\t\t}\n\n\t\tnew Path(x + 30, y).right(Options.AR).addTo(this);\n\t\tnormal.format(x + 30 + Options.AR, y, this.innerWidth).addTo(this);\n\t\tnew Path(x + 30 + Options.AR + this.innerWidth, y + this.height).right(Options.AR).addTo(this);\n\n\t\tfor(i = this.normal+1; i < this.items.length; i++) {\n\t\t\tlet item = this.items[i];\n\t\t\tif(i == this.normal + 1) {\n\t\t\t\tdistanceFromY = Math.max(10+Options.AR, normal.height + normal.down + Options.VS + item.up);\n\t\t\t}\n\t\t\tnew Path(x + 30, y)\n\t\t\t\t.down(distanceFromY - Options.AR)\n\t\t\t\t.arc('ws')\n\t\t\t\t.addTo(this);\n\t\t\titem.format(x + 30 + Options.AR, y + distanceFromY, this.innerWidth).addTo(this);\n\t\t\tnew Path(x + 30 + Options.AR + this.innerWidth, y + distanceFromY + item.height)\n\t\t\t\t.arc('se')\n\t\t\t\t.up(distanceFromY - Options.AR + item.height - normal.height)\n\t\t\t\t.addTo(this);\n\t\t\tif(i != this.items.length - 1) {\n\t\t\t\tdistanceFromY += Math.max(Options.AR, item.height + item.down + Options.VS + this.items[i+1].up);\n\t\t\t}\n\t\t}\n\t\tvar text = new FakeSVG('g', {\"class\": \"diagram-text\"}).addTo(this);\n\t\tnew FakeSVG('title', {}, (this.type==\"any\"?\"take one or more branches, once each, in any order\":\"take all branches, once each, in any order\")).addTo(text);\n\t\tnew FakeSVG('path', {\n\t\t\t\"d\": \"M \"+(x+30)+\" \"+(y-10)+\" h -26 a 4 4 0 0 0 -4 4 v 12 a 4 4 0 0 0 4 4 h 26 z\",\n\t\t\t\"class\": \"diagram-text\"\n\t\t\t}).addTo(text);\n\t\tnew FakeSVG('text', {\n\t\t\t\"x\": x + 15,\n\t\t\t\"y\": y + 4,\n\t\t\t\"class\": \"diagram-text\"\n\t\t\t}, (this.type==\"any\"?\"1+\":\"all\")).addTo(text);\n\t\tnew FakeSVG('path', {\n\t\t\t\"d\": \"M \"+(x+this.width-20)+\" \"+(y-10)+\" h 16 a 4 4 0 0 1 4 4 v 12 a 4 4 0 0 1 -4 4 h -16 z\",\n\t\t\t\"class\": \"diagram-text\"\n\t\t\t}).addTo(text);\n\t\tnew FakeSVG('path', {\n\t\t\t\"d\": \"M \"+(x+this.width-13)+\" \"+(y-2)+\" a 4 4 0 1 0 6 -1 m 2.75 -1 h -4 v 4 m 0 -3 h 2\",\n\t\t\t\"style\": \"stroke-width: 1.75\"\n\t\t\t}).addTo(text);\n\t\treturn this;\n\t}\n}\nfuncs.MultipleChoice = (...args)=>new MultipleChoice(...args);\n\n\nexport class Optional extends FakeSVG {\n\tconstructor(item, skip) {\n\t\tif( skip === undefined )\n\t\t\treturn new Choice(1, new Skip(), item);\n\t\telse if ( skip === \"skip\" )\n\t\t\treturn new Choice(0, new Skip(), item);\n\t\telse\n\t\t\tthrow \"Unknown value for Optional()'s 'skip' argument.\";\n\t}\n}\nfuncs.Optional = (...args)=>new Optional(...args);\n\n\nexport class OneOrMore extends FakeSVG {\n\tconstructor(item, rep) {\n\t\tsuper('g');\n\t\trep = rep || (new Skip());\n\t\tthis.item = wrapString(item);\n\t\tthis.rep = wrapString(rep);\n\t\tthis.width = Math.max(this.item.width, this.rep.width) + Options.AR*2;\n\t\tthis.height = this.item.height;\n\t\tthis.up = this.item.up;\n\t\tthis.down = Math.max(Options.AR*2, this.item.down + Options.VS + this.rep.up + this.rep.height + this.rep.down);\n\t\tthis.needsSpace = true;\n\t\tif(Options.DEBUG) {\n\t\t\tthis.attrs['data-updown'] = this.up + \" \" + this.height + \" \" + this.down;\n\t\t\tthis.attrs['data-type'] = \"oneormore\";\n\t\t}\n\t}\n\tformat(x,y,width) {\n\t\t// Hook up the two sides if this is narrower than its stated width.\n\t\tvar gaps = determineGaps(width, this.width);\n\t\tnew Path(x,y).h(gaps[0]).addTo(this);\n\t\tnew Path(x+gaps[0]+this.width,y+this.height).h(gaps[1]).addTo(this);\n\t\tx += gaps[0];\n\n\t\t// Draw item\n\t\tnew Path(x,y).right(Options.AR).addTo(this);\n\t\tthis.item.format(x+Options.AR,y,this.width-Options.AR*2).addTo(this);\n\t\tnew Path(x+this.width-Options.AR,y+this.height).right(Options.AR).addTo(this);\n\n\t\t// Draw repeat arc\n\t\tvar distanceFromY = Math.max(Options.AR*2, this.item.height+this.item.down+Options.VS+this.rep.up);\n\t\tnew Path(x+Options.AR,y).arc('nw').down(distanceFromY-Options.AR*2).arc('ws').addTo(this);\n\t\tthis.rep.format(x+Options.AR, y+distanceFromY, this.width - Options.AR*2).addTo(this);\n\t\tnew Path(x+this.width-Options.AR, y+distanceFromY+this.rep.height).arc('se').up(distanceFromY-Options.AR*2+this.rep.height-this.item.height).arc('en').addTo(this);\n\n\t\treturn this;\n\t}\n\twalk(cb) {\n\t\tcb(this);\n\t\tthis.item.walk(cb);\n\t\tthis.rep.walk(cb);\n\t}\n}\nfuncs.OneOrMore = (...args)=>new OneOrMore(...args);\n\n\nexport class ZeroOrMore extends FakeSVG {\n\tconstructor(item, rep, skip) {\n\t\treturn new Optional(new OneOrMore(item, rep), skip);\n\t}\n}\nfuncs.ZeroOrMore = (...args)=>new ZeroOrMore(...args);\n\n\nexport class Group extends FakeSVG {\n\tconstructor(item, label) {\n\t\tsuper('g');\n\t\tthis.item = wrapString(item);\n\t\tthis.label =\n\t\t\tlabel instanceof FakeSVG\n\t\t\t\t? label\n\t\t\t\t: label\n\t\t\t\t\t? new Comment(label)\n\t\t\t\t\t: undefined;\n\n\t\tthis.width = Math.max(\n\t\t\tthis.item.width + (this.item.needsSpace?20:0),\n\t\t\tthis.label ? this.label.width : 0,\n\t\t\tOptions.AR*2);\n\t\tthis.height = this.item.height;\n\t\tthis.boxUp = this.up = Math.max(this.item.up + Options.VS, Options.AR);\n\t\tif(this.label) {\n\t\t\tthis.up += this.label.up + this.label.height + this.label.down;\n\t\t}\n\t\tthis.down = Math.max(this.item.down + Options.VS, Options.AR);\n\t\tthis.needsSpace = true;\n\t\tif(Options.DEBUG) {\n\t\t\tthis.attrs['data-updown'] = this.up + \" \" + this.height + \" \" + this.down;\n\t\t\tthis.attrs['data-type'] = \"group\";\n\t\t}\n\t}\n\tformat(x, y, width) {\n\t\tvar gaps = determineGaps(width, this.width);\n\t\tnew Path(x,y).h(gaps[0]).addTo(this);\n\t\tnew Path(x+gaps[0]+this.width,y+this.height).h(gaps[1]).addTo(this);\n\t\tx += gaps[0];\n\n\t\tnew FakeSVG('rect', {\n\t\t\tx,\n\t\t\ty:y-this.boxUp,\n\t\t\twidth:this.width,\n\t\t\theight:this.boxUp + this.height + this.down,\n\t\t\trx: Options.AR,\n\t\t\try: Options.AR,\n\t\t\t'class':'group-box',\n\t\t}).addTo(this);\n\n\t\tthis.item.format(x,y,this.width).addTo(this);\n\t\tif(this.label) {\n\t\t\tthis.label.format(\n\t\t\t\tx,\n\t\t\t\ty-(this.boxUp+this.label.down+this.label.height),\n\t\t\t\tthis.label.width).addTo(this);\n\t\t}\n\n\t\treturn this;\n\t}\n\twalk(cb) {\n\t\tcb(this);\n\t\tthis.item.walk(cb);\n\t\tthis.label.walk(cb);\n\t}\n}\nfuncs.Group = (...args)=>new Group(...args);\n\n\nexport class Start extends FakeSVG {\n\tconstructor({type=\"simple\", label}={}) {\n\t\tsuper('g');\n\t\tthis.width = 20;\n\t\tthis.height = 0;\n\t\tthis.up = 10;\n\t\tthis.down = 10;\n\t\tthis.type = type;\n\t\tif(label) {\n\t\t\tthis.label = \"\"+label;\n\t\t\tthis.width = Math.max(20, this.label.length * Options.CHAR_WIDTH + 10);\n\t\t}\n\t\tif(Options.DEBUG) {\n\t\t\tthis.attrs['data-updown'] = this.up + \" \" + this.height + \" \" + this.down;\n\t\t\tthis.attrs['data-type'] = \"start\";\n\t\t}\n\t}\n\tformat(x,y) {\n\t\tlet path = new Path(x, y-10);\n\t\tif (this.type === \"complex\") {\n\t\t\tpath.down(20)\n\t\t\t\t.m(0, -10)\n\t\t\t\t.right(this.width)\n\t\t\t\t.addTo(this);\n\t\t} else {\n\t\t\tpath.down(20)\n\t\t\t\t.m(10, -20)\n\t\t\t\t.down(20)\n\t\t\t\t.m(-10, -10)\n\t\t\t\t.right(this.width)\n\t\t\t\t.addTo(this);\n\t\t}\n\t\tif(this.label) {\n\t\t\tnew FakeSVG('text', {x:x, y:y-15, style:\"text-anchor:start\"}, this.label).addTo(this);\n\t\t}\n\t\treturn this;\n\t}\n}\nfuncs.Start = (...args)=>new Start(...args);\n\n\nexport class End extends FakeSVG {\n\tconstructor({type=\"simple\"}={}) {\n\t\tsuper('path');\n\t\tthis.width = 20;\n\t\tthis.height = 0;\n\t\tthis.up = 10;\n\t\tthis.down = 10;\n\t\tthis.type = type;\n\t\tif(Options.DEBUG) {\n\t\t\tthis.attrs['data-updown'] = this.up + \" \" + this.height + \" \" + this.down;\n\t\t\tthis.attrs['data-type'] = \"end\";\n\t\t}\n\t}\n\tformat(x,y) {\n\t\tif (this.type === \"complex\") {\n\t\t\tthis.attrs.d = 'M '+x+' '+y+' h 20 m 0 -10 v 20';\n\t\t} else {\n\t\t\tthis.attrs.d = 'M '+x+' '+y+' h 20 m -10 -10 v 20 m 10 -20 v 20';\n\t\t}\n\t\treturn this;\n\t}\n}\nfuncs.End = (...args)=>new End(...args);\n\n\nexport class Terminal extends FakeSVG {\n\tconstructor(text, {href, title}={}) {\n\t\tsuper('g', {'class': 'terminal'});\n\t\tthis.text = \"\"+text;\n\t\tthis.href = href;\n\t\tthis.title = title;\n\t\tthis.width = this.text.length * Options.CHAR_WIDTH + 20; /* Assume that each char is .5em, and that the em is 16px */\n\t\tthis.height = 0;\n\t\tthis.up = 11;\n\t\tthis.down = 11;\n\t\tthis.needsSpace = true;\n\t\tif(Options.DEBUG) {\n\t\t\tthis.attrs['data-updown'] = this.up + \" \" + this.height + \" \" + this.down;\n\t\t\tthis.attrs['data-type'] = \"terminal\";\n\t\t}\n\t}\n\tformat(x, y, width) {\n\t\t// Hook up the two sides if this is narrower than its stated width.\n\t\tvar gaps = determineGaps(width, this.width);\n\t\tnew Path(x,y).h(gaps[0]).addTo(this);\n\t\tnew Path(x+gaps[0]+this.width,y).h(gaps[1]).addTo(this);\n\t\tx += gaps[0];\n\n\t\tnew FakeSVG('rect', {x:x, y:y-11, width:this.width, height:this.up+this.down, rx:10, ry:10}).addTo(this);\n\t\tvar text = new FakeSVG('text', {x:x+this.width/2, y:y+4}, this.text);\n\t\tif(this.href)\n\t\t\tnew FakeSVG('a', {'xlink:href': this.href}, [text]).addTo(this);\n\t\telse\n\t\t\ttext.addTo(this);\n\t\tif(this.title)\n\t\t\tnew FakeSVG('title', {}, [this.title]).addTo(this);\n\t\treturn this;\n\t}\n}\nfuncs.Terminal = (...args)=>new Terminal(...args);\n\n\nexport class NonTerminal extends FakeSVG {\n\tconstructor(text, {href, title}={}) {\n\t\tsuper('g', {'class': 'non-terminal'});\n\t\tthis.text = \"\"+text;\n\t\tthis.href = href;\n\t\tthis.title = title;\n\t\tthis.width = this.text.length * Options.CHAR_WIDTH + 20;\n\t\tthis.height = 0;\n\t\tthis.up = 11;\n\t\tthis.down = 11;\n\t\tthis.needsSpace = true;\n\t\tif(Options.DEBUG) {\n\t\t\tthis.attrs['data-updown'] = this.up + \" \" + this.height + \" \" + this.down;\n\t\t\tthis.attrs['data-type'] = \"nonterminal\";\n\t\t}\n\t}\n\tformat(x, y, width) {\n\t\t// Hook up the two sides if this is narrower than its stated width.\n\t\tvar gaps = determineGaps(width, this.width);\n\t\tnew Path(x,y).h(gaps[0]).addTo(this);\n\t\tnew Path(x+gaps[0]+this.width,y).h(gaps[1]).addTo(this);\n\t\tx += gaps[0];\n\n\t\tnew FakeSVG('rect', {x:x, y:y-11, width:this.width, height:this.up+this.down}).addTo(this);\n\t\tvar text = new FakeSVG('text', {x:x+this.width/2, y:y+4}, this.text);\n\t\tif(this.href)\n\t\t\tnew FakeSVG('a', {'xlink:href': this.href}, [text]).addTo(this);\n\t\telse\n\t\t\ttext.addTo(this);\n\t\tif(this.title)\n\t\t\tnew FakeSVG('title', {}, [this.title]).addTo(this);\n\t\treturn this;\n\t}\n}\nfuncs.NonTerminal = (...args)=>new NonTerminal(...args);\n\n\nexport class Comment extends FakeSVG {\n\tconstructor(text, {href, title}={}) {\n\t\tsuper('g');\n\t\tthis.text = \"\"+text;\n\t\tthis.href = href;\n\t\tthis.title = title;\n\t\tthis.width = this.text.length * Options.COMMENT_CHAR_WIDTH + 10;\n\t\tthis.height = 0;\n\t\tthis.up = 8;\n\t\tthis.down = 8;\n\t\tthis.needsSpace = true;\n\t\tif(Options.DEBUG) {\n\t\t\tthis.attrs['data-updown'] = this.up + \" \" + this.height + \" \" + this.down;\n\t\t\tthis.attrs['data-type'] = \"comment\";\n\t\t}\n\t}\n\tformat(x, y, width) {\n\t\t// Hook up the two sides if this is narrower than its stated width.\n\t\tvar gaps = determineGaps(width, this.width);\n\t\tnew Path(x,y).h(gaps[0]).addTo(this);\n\t\tnew Path(x+gaps[0]+this.width,y+this.height).h(gaps[1]).addTo(this);\n\t\tx += gaps[0];\n\n\t\tvar text = new FakeSVG('text', {x:x+this.width/2, y:y+5, class:'comment'}, this.text);\n\t\tif(this.href)\n\t\t\tnew FakeSVG('a', {'xlink:href': this.href}, [text]).addTo(this);\n\t\telse\n\t\t\ttext.addTo(this);\n\t\tif(this.title)\n\t\t\tnew FakeSVG('title', {}, this.title).addTo(this);\n\t\treturn this;\n\t}\n}\nfuncs.Comment = (...args)=>new Comment(...args);\n\n\nexport class Skip extends FakeSVG {\n\tconstructor() {\n\t\tsuper('g');\n\t\tthis.width = 0;\n\t\tthis.height = 0;\n\t\tthis.up = 0;\n\t\tthis.down = 0;\n\t\tthis.needsSpace = false;\n\t\tif(Options.DEBUG) {\n\t\t\tthis.attrs['data-updown'] = this.up + \" \" + this.height + \" \" + this.down;\n\t\t\tthis.attrs['data-type'] = \"skip\";\n\t\t}\n\t}\n\tformat(x, y, width) {\n\t\tnew Path(x,y).right(width).addTo(this);\n\t\treturn this;\n\t}\n}\nfuncs.Skip = (...args)=>new Skip(...args);\n\n\nexport class Block extends FakeSVG {\n\tconstructor({width=50, up=15, height=25, down=15, needsSpace=true}={}) {\n\t\tsuper('g');\n\t\tthis.width = width;\n\t\tthis.height = height;\n\t\tthis.up = up;\n\t\tthis.down = down;\n\t\tthis.needsSpace = needsSpace;\n\t\tif(Options.DEBUG) {\n\t\t\tthis.attrs['data-updown'] = this.up + \" \" + this.height + \" \" + this.down;\n\t\t\tthis.attrs['data-type'] = \"block\";\n\t\t}\n\t}\n\tformat(x, y, width) {\n\t\t// Hook up the two sides if this is narrower than its stated width.\n\t\tvar gaps = determineGaps(width, this.width);\n\t\tnew Path(x,y).h(gaps[0]).addTo(this);\n\t\tnew Path(x+gaps[0]+this.width,y).h(gaps[1]).addTo(this);\n\t\tx += gaps[0];\n\n\t\tnew FakeSVG('rect', {x:x, y:y-this.up, width:this.width, height:this.up+this.height+this.down}).addTo(this);\n\t\treturn this;\n\t}\n}\nfuncs.Block = (...args)=>new Block(...args);\n\n\nfunction unnull(...args) {\n\t// Return the first value that isn't undefined.\n\t// More correct than `v1 || v2 || v3` because falsey values will be returned.\n\treturn args.reduce(function(sofar, x) { return sofar !== undefined ? sofar : x; });\n}\n\nfunction determineGaps(outer, inner) {\n\tvar diff = outer - inner;\n\tswitch(Options.INTERNAL_ALIGNMENT) {\n\t\tcase 'left': return [0, diff];\n\t\tcase 'right': return [diff, 0];\n\t\tdefault: return [diff/2, diff/2];\n\t}\n}\n\nfunction wrapString(value) {\n\t\treturn value instanceof FakeSVG ? value : new Terminal(\"\"+value);\n}\n\nfunction sum(iter, func) {\n\tif(!func) func = function(x) { return x; };\n\treturn iter.map(func).reduce(function(a,b){return a+b}, 0);\n}\n\nfunction max(iter, func) {\n\tif(!func) func = function(x) { return x; };\n\treturn Math.max.apply(null, iter.map(func));\n}\n\nfunction SVG(name, attrs, text) {\n\tattrs = attrs || {};\n\ttext = text || '';\n\tvar el = document.createElementNS(\"http://www.w3.org/2000/svg\",name);\n\tfor(var attr in attrs) {\n\t\tif(attr === 'xlink:href')\n\t\t\tel.setAttributeNS(\"http://www.w3.org/1999/xlink\", 'href', attrs[attr]);\n\t\telse\n\t\t\tel.setAttribute(attr, attrs[attr]);\n\t}\n\tel.textContent = text;\n\treturn el;\n}\n\nfunction escapeString(string) {\n\t// Escape markdown and HTML special characters\n\treturn string.replace(/[*_`[\\]<&]/g, function(charString) {\n\t\treturn '&#' + charString.charCodeAt(0) + ';';\n\t});\n}\n\nfunction* enumerate(iter) {\n\tvar count = 0;\n\tfor(const x of iter) {\n\t\tyield [count, x];\n\t\tcount++;\n\t}\n}\n\nfunction diagramFromJSON(Diagram, input) {\n\tif (!input) return new Diagram();\n\t// Wrap an array of nodes in the diagram type decided by the parent\n\t// class of the calling static fromJSON method.\n\tif (Array.isArray(input)) {\n\t\treturn new Diagram(...input.map(nodeFromJSON));\n\t}\n\t// Retain the diagram type specified in the input regardless the parent\n\t// class of the calling static fromJSON method.\n\tswitch (input.type) {\n\t\tcase 'Diagram':\n\t\tcase 'ComplexDiagram':\n\t\t\treturn nodeFromJSON(input);\n\t}\n\t// Wrap the single node in the diagram type decided by the parent\n\t// class of the calling static fromJSON method.\n\treturn new Diagram(nodeFromJSON(input));\n}\n\nconst classes = {\n\tDiagram, ComplexDiagram, Sequence, Stack, VerticalSequence, OptionalSequence,\n\tHorizontalChoice, AlternatingSequence, Choice, MultipleChoice, Optional,\n\tOneOrMore, ZeroOrMore, Group, Start, End, Terminal, NonTerminal, Comment, Skip\n}\n\nfunction nodeFromJSON(node) {\n\tif (!node) return;\n\tconst Node = classes[node.type];\n\tswitch (Node) {\n\t\tcase Diagram:\n\t\tcase ComplexDiagram:\n\t\tcase Sequence:\n\t\tcase Stack:\n\t\tcase VerticalSequence:\n\t\tcase OptionalSequence:\n\t\tcase HorizontalChoice:\n\t\t\treturn new Node(...itemsFromJSON(node.items));\n\n\t\tcase AlternatingSequence:\n\t\t\treturn new Node(nodeFromJSON(node.option1), nodeFromJSON(node.option2));\n\n\t\tcase Choice:\n\t\t\treturn new Node(node.normalIndex || 0, ...itemsFromJSON(node.options));\n\n\t\tcase MultipleChoice:\n\t\t\treturn new Node(node.normalIndex || 0, node.choiceType,\n\t\t\t\t...itemsFromJSON(node.options));\n\n\t\tcase Optional:\n\t\t\treturn new Node(nodeFromJSON(node.item), node.skip && 'skip');\n\n\t\tcase OneOrMore:\n\t\t\treturn new Node(nodeFromJSON(node.item), nodeFromJSON(node.repeat));\n\n\t\tcase ZeroOrMore:\n\t\t\treturn new Node(nodeFromJSON(node.item), nodeFromJSON(node.repeat),\n\t\t\t\tnode.skip && 'skip');\n\n\t\tcase Group:\n\t\t\treturn new Node(nodeFromJSON(node.item), node.label);\n\n\t\tcase Start:\n\t\t\treturn new Node(node.startType, node.label);\n\n\t\tcase End:\n\t\t\treturn new Node(node.endType);\n\n\t\tcase Terminal:\n\t\tcase NonTerminal:\n\t\tcase Comment:\n\t\t\treturn new Node(node.text, { href: node.href, title: node.title });\n\n\t\tcase Skip:\n\t\t\treturn new Node();\n\t}\n\tthrow new Error(`Unknown node type: \"${node.type}\".`)\n}\n\nfunction itemsFromJSON(items) {\n\treturn items ? items.map(nodeFromJSON) : [];\n}\n"],"names":["funcs","Options","DEBUG","VS","AR","DIAGRAM_CLASS","STROKE_ODD_PIXEL_LENGTH","INTERNAL_ALIGNMENT","CHAR_WIDTH","COMMENT_CHAR_WIDTH","defaultCSS","FakeSVG","[object Object]","tagName","attrs","text","this","children","unnull","parent","push","svg","toSVG","appendChild","el","name","document","createElementNS","attr","setAttributeNS","setAttribute","textContent","SVG","forEach","e","str","group","replace","charString","charCodeAt","cb","Path","x","y","super","d","val","h","Math","max","v","sweep","cw","start","dir","arc","s2","sqrt","s2inv","path","sd","join","DiagramMultiContainer","items","map","wrapString","walk","Diagram","class","Start","unshift","length","End","up","down","height","width","item","needsSpace","formatted","paddingt","paddingr","paddingb","paddingl","g","transform","i","addTo","format","viewBox","scriptTag","getElementsByTagName","parentNode","call","toString","style","s","xmlns","result","pop","input","diagramFromJSON","args","fromJSON","ComplexDiagram","diagram","type","Sequence","numberOfItems","gaps","determineGaps","Stack","RangeError","apply","last","xInitial","innerWidth","left","VerticalSequence","minWidth","itemNum","OptionalSequence","sum","heightSoFar","itemWidth","right","upperLineY","itemSpace","AlternatingSequence","vert","first","second","arcX","arcY","crossY","crossX","firstOut","secondIn","firstWidth","secondWidth","firstIn","secondOut","crossBar","arc_8","l","Choice","normal","floor","TypeError","arcs","distanceFromY","HorizontalChoice","allButLast","slice","middles","_upperTrack","_lowerTrack","allButFirst","upperSpan","lowerSpan","lowerStart","iter","count","enumerate","MultipleChoice","SyntaxError","minimum","Optional","skip","undefined","Skip","OneOrMore","rep","ZeroOrMore","Group","label","Comment","boxUp","rx","ry","m","Terminal","href","title","xlink:href","NonTerminal","Block","reduce","sofar","outer","inner","diff","value","func","a","b","Array","isArray","nodeFromJSON","classes","node","Node","itemsFromJSON","option1","option2","normalIndex","options","choiceType","repeat","startType","endType","Error"],"mappings":"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"}